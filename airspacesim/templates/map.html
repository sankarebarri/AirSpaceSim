<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airspace Operations View</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="../static/css/map_styles.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
    <main class="layout">
        <section class="map-shell">
            <header class="shell-header">
                <h1>Airspace Operations View</h1>
                <p id="config-status" class="status-pill">Loading config...</p>
            </header>
            <div id="map" aria-label="Airspace map"></div>
        </section>

        <aside class="panel-shell" aria-label="Airspace telemetry panel">
            <section class="panel-card">
                <h2>Map Elements</h2>
                <div class="metrics">
                    <div><span class="metric-label">Routes</span><span id="route-count">0</span></div>
                    <div><span class="metric-label">Zones</span><span id="zone-count">0</span></div>
                    <div><span class="metric-label">Nav Aids</span><span id="nav-count">0</span></div>
                </div>
                <ul id="route-list" class="list"></ul>
            </section>

            <section class="panel-card">
                <h2>Aircraft</h2>
                <div class="metrics">
                    <div><span class="metric-label">Tracked</span><span id="aircraft-count">0</span></div>
                    <div><span class="metric-label">Last Sync</span><span id="aircraft-sync">Never</span></div>
                </div>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Callsign</th>
                                <th>FL</th>
                                <th>Position</th>
                            </tr>
                        </thead>
                        <tbody id="aircraft-table-body"></tbody>
                    </table>
                </div>
                <p id="aircraft-status" class="status-line">Waiting for aircraft feed...</p>
                <p id="selected-aircraft-status" class="status-line">Selected: none</p>
            </section>

            <section class="panel-card">
                <h2>Flow Legend</h2>
                <ul class="legend-list" aria-label="Traffic flow legend">
                    <li><span class="legend-swatch outbound" aria-hidden="true"></span>Outbound</li>
                    <li><span class="legend-swatch inbound" aria-hidden="true"></span>Inbound</li>
                    <li><span class="legend-swatch transit" aria-hidden="true"></span>Transit</li>
                    <li><span class="legend-swatch unknown" aria-hidden="true"></span>Unknown</li>
                </ul>
            </section>

            <section class="panel-card">
                <h2>Operator Controls</h2>

                <form id="form-add-aircraft" class="control-form">
                    <h3>Add Aircraft</h3>
                    <div class="grid-2">
                        <label>Aircraft ID<input id="add-aircraft-id" type="text" required placeholder="AC900" /></label>
                        <label>Callsign<input id="add-callsign" type="text" placeholder="OPS900" /></label>
                        <label>Route ID<input id="add-route-id" type="text" required placeholder="UA612" /></label>
                        <label>Speed (kt)<input id="add-speed-kt" type="number" min="1" step="1" value="420" required /></label>
                        <label>Flight Level (FL)<input id="add-flight-level" type="number" min="0" step="1" placeholder="350" /></label>
                    </div>
                    <button type="submit">Queue ADD_AIRCRAFT</button>
                </form>

                <form id="form-set-speed" class="control-form">
                    <h3>Set Aircraft Speed</h3>
                    <p class="helper-line">Use runtime aircraft ID (for example, <code>AC800</code>), not callsign.</p>
                    <div class="grid-2">
                        <label>Aircraft ID<input id="set-speed-aircraft-id" type="text" required placeholder="AC900" /></label>
                        <label>Speed (kt)<input id="set-speed-kt" type="number" min="1" step="1" value="240" required /></label>
                    </div>
                    <button type="submit">Queue SET_SPEED</button>
                </form>

                <form id="form-set-flight-level" class="control-form">
                    <h3>Set Flight Level</h3>
                    <p class="helper-line">Flight level is metadata only; it does not change movement physics.</p>
                    <p class="helper-line" id="set-fl-current">Current FL: -</p>
                    <div class="grid-2">
                        <label>Aircraft ID<input id="set-fl-aircraft-id" type="text" required placeholder="AC900" /></label>
                        <label>Flight Level (FL)<input id="set-flight-level" type="number" min="0" step="1" value="300" required /></label>
                    </div>
                    <button type="submit">Queue SET_FL</button>
                </form>

                <form id="form-set-sim-rate" class="control-form">
                    <h3>Set Simulation Rate</h3>
                    <div class="grid-2">
                        <label>Sim Rate<input id="set-sim-rate" type="number" min="0.1" step="0.1" value="1.0" required /></label>
                    </div>
                    <button type="submit">Queue SET_SIMULATION_SPEED</button>
                </form>

                <div class="control-actions">
                    <button id="btn-copy-events" type="button">Copy Event Payload</button>
                    <button id="btn-clear-events" type="button">Clear Pending Events</button>
                </div>
                <textarea id="events-payload" rows="8" readonly aria-label="Generated event payload"></textarea>
                <p id="controls-status" class="status-line">
                    Initializing command sink...
                </p>
            </section>
        </aside>
    </main>

    <script type="module" src="../static/js/aircraft_simulation.js?v=20260305"></script>
</body>

</html>
